---
stages:
  - init
  - gen
  - build
  - ostree-gen
  - ostree-build
  - verify
  - finish

variables:
  # Set the parent pipeline ID as a global variable so that the child pipeline
  # jobs can use it to retrieve artifacts.
  PARENT_PIPELINE_ID: $CI_PIPELINE_ID

init:
  stage: init
  interruptible: true
  tags:
    - shell
  script:
    - schutzbot/update_github_status.sh start

check-build-coverage:
  stage: verify
  image: fedora:latest
  variables:
    PYTHONUNBUFFERED: 1
  script:
    - ./test/scripts/install-dependencies
    - ./test/scripts/check-build-coverage ./s3configs/
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images

finish:
  stage: finish
  dependencies: []
  tags:
    - shell
  script:
    - schutzbot/update_github_status.sh finish

fail:
  stage: finish
  tags:
    - shell
  script:
    - schutzbot/update_github_status.sh fail
    - exit 1  # make the pipeline fail so it doesn't look like success
  when: on_failure

.base:
  before_script:
    - cat schutzbot/team_ssh_keys.txt |
        tee -a ~/.ssh/authorized_keys > /dev/null
  interruptible: true
  retry: 1
  tags:
    - terraform
  variables:
    PYTHONUNBUFFERED: 1

.terraform:
  extends: .base
  tags:
    - terraform

generate-build-config-centos-10-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro centos-10 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-centos-10-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro centos-10 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-centos-8-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro centos-8 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-centos-8-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro centos-8 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-centos-9-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro centos-9 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-centos-9-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro centos-9 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-fedora-38-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro fedora-38 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-fedora-38-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro fedora-38 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-fedora-39-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro fedora-39 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-fedora-39-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro fedora-39 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-10.0-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-10.0 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-10.0-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-10.0 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-7.9-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-7.9 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.10-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.10 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.10-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.10 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.4-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.4 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.4-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.4 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.5-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.5 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.5-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.5 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.6-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.6 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.6-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.6 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.7-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.7 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.7-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.7 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.8-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.8 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.8-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.8 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.9-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.9 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-8.9-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-8.9 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.0-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.0 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.0-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.0 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.1-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.1 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.1-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.1 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.2-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.2 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.2-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.2 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.3-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.3 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.3-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.3 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.4-aarch64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.4 --arch aarch64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-build-config-rhel-9.4-x86_64:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-build-config --distro rhel-9.4 --arch x86_64 build-config.yml
  artifacts:
    paths:
      - build-config.yml
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images

image-build-trigger-centos-10-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-centos-10-aarch64
    strategy: depend
  needs:
    - generate-build-config-centos-10-aarch64


image-build-trigger-centos-10-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-centos-10-x86_64
    strategy: depend
  needs:
    - generate-build-config-centos-10-x86_64


image-build-trigger-centos-8-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-centos-8-aarch64
    strategy: depend
  needs:
    - generate-build-config-centos-8-aarch64


image-build-trigger-centos-8-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-centos-8-x86_64
    strategy: depend
  needs:
    - generate-build-config-centos-8-x86_64


image-build-trigger-centos-9-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-centos-9-aarch64
    strategy: depend
  needs:
    - generate-build-config-centos-9-aarch64


image-build-trigger-centos-9-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-centos-9-x86_64
    strategy: depend
  needs:
    - generate-build-config-centos-9-x86_64


image-build-trigger-fedora-38-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-fedora-38-aarch64
    strategy: depend
  needs:
    - generate-build-config-fedora-38-aarch64


image-build-trigger-fedora-38-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-fedora-38-x86_64
    strategy: depend
  needs:
    - generate-build-config-fedora-38-x86_64


image-build-trigger-fedora-39-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-fedora-39-aarch64
    strategy: depend
  needs:
    - generate-build-config-fedora-39-aarch64


image-build-trigger-fedora-39-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-fedora-39-x86_64
    strategy: depend
  needs:
    - generate-build-config-fedora-39-x86_64


image-build-trigger-rhel-10.0-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-10.0-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-10.0-aarch64


image-build-trigger-rhel-10.0-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-10.0-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-10.0-x86_64


image-build-trigger-rhel-7.9-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-7.9-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-7.9-x86_64


image-build-trigger-rhel-8.10-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.10-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.10-aarch64


image-build-trigger-rhel-8.10-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.10-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.10-x86_64


image-build-trigger-rhel-8.4-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.4-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.4-aarch64


image-build-trigger-rhel-8.4-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.4-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.4-x86_64


image-build-trigger-rhel-8.5-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.5-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.5-aarch64


image-build-trigger-rhel-8.5-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.5-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.5-x86_64


image-build-trigger-rhel-8.6-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.6-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.6-aarch64


image-build-trigger-rhel-8.6-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.6-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.6-x86_64


image-build-trigger-rhel-8.7-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.7-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.7-aarch64


image-build-trigger-rhel-8.7-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.7-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.7-x86_64


image-build-trigger-rhel-8.8-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.8-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.8-aarch64


image-build-trigger-rhel-8.8-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.8-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.8-x86_64


image-build-trigger-rhel-8.9-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.9-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.9-aarch64


image-build-trigger-rhel-8.9-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-8.9-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-8.9-x86_64


image-build-trigger-rhel-9.0-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.0-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.0-aarch64


image-build-trigger-rhel-9.0-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.0-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.0-x86_64


image-build-trigger-rhel-9.1-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.1-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.1-aarch64


image-build-trigger-rhel-9.1-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.1-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.1-x86_64


image-build-trigger-rhel-9.2-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.2-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.2-aarch64


image-build-trigger-rhel-9.2-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.2-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.2-x86_64


image-build-trigger-rhel-9.3-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.3-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.3-aarch64


image-build-trigger-rhel-9.3-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.3-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.3-x86_64


image-build-trigger-rhel-9.4-aarch64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.4-aarch64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.4-aarch64


image-build-trigger-rhel-9.4-x86_64:
  stage: build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-build-config-rhel-9.4-x86_64
    strategy: depend
  needs:
    - generate-build-config-rhel-9.4-x86_64

generate-ostree-build-config-centos-10-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro centos-10 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-centos-10-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-centos-10-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro centos-10 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-centos-10-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-centos-8-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro centos-8 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-centos-8-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-centos-8-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro centos-8 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-centos-8-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-centos-9-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro centos-9 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-centos-9-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-centos-9-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro centos-9 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-centos-9-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-fedora-38-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro fedora-38 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-fedora-38-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-fedora-38-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro fedora-38 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-fedora-38-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-fedora-39-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro fedora-39 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-fedora-39-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-fedora-39-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro fedora-39 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-fedora-39-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-10.0-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-10.0 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-10.0-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-10.0-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-10.0 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-10.0-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-7.9-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-7.9 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-7.9-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.10-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.10 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.10-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.10-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.10 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.10-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.4-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.4 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.4-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.4-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.4 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.4-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.5-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.5 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.5-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.5-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.5 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.5-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.6-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.6 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.6-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.6-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.6 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.6-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.7-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.7 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.7-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.7-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.7 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.7-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.8-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.8 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.8-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.8-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.8 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.8-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.9-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.9 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.9-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-8.9-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-8.9 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-8.9-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.0-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.0 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.0-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.0-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.0 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.0-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.1-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.1 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.1-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.1-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.1 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.1-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.2-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.2 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.2-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.2-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.2 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.2-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.3-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.3 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.3-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.3-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.3 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.3-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.4-aarch64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-aarch64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.4 --arch aarch64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.4-aarch64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images


generate-ostree-build-config-rhel-9.4-x86_64:
  stage: ostree-gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/setup-osbuild-repo
    - sudo ./test/scripts/install-dependencies
    - ./test/scripts/generate-ostree-build-config --distro rhel-9.4 --arch x86_64 build-config.yml build-configs
  artifacts:
    paths:
      - build-config.yml
      - build-configs
  needs:
    - image-build-trigger-rhel-9.4-x86_64
  cache:
    key: testcache
    paths:
      - .cache/osbuild-images

image-build-ostree-trigger-centos-10-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-centos-10-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-centos-10-aarch64


image-build-ostree-trigger-centos-10-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-centos-10-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-centos-10-x86_64


image-build-ostree-trigger-centos-8-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-centos-8-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-centos-8-aarch64


image-build-ostree-trigger-centos-8-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-centos-8-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-centos-8-x86_64


image-build-ostree-trigger-centos-9-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-centos-9-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-centos-9-aarch64


image-build-ostree-trigger-centos-9-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-centos-9-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-centos-9-x86_64


image-build-ostree-trigger-fedora-38-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-fedora-38-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-fedora-38-aarch64


image-build-ostree-trigger-fedora-38-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-fedora-38-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-fedora-38-x86_64


image-build-ostree-trigger-fedora-39-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-fedora-39-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-fedora-39-aarch64


image-build-ostree-trigger-fedora-39-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-fedora-39-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-fedora-39-x86_64


image-build-ostree-trigger-rhel-10.0-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-10.0-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-10.0-aarch64


image-build-ostree-trigger-rhel-10.0-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-10.0-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-10.0-x86_64


image-build-ostree-trigger-rhel-7.9-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-7.9-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-7.9-x86_64


image-build-ostree-trigger-rhel-8.10-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.10-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.10-aarch64


image-build-ostree-trigger-rhel-8.10-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.10-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.10-x86_64


image-build-ostree-trigger-rhel-8.4-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.4-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.4-aarch64


image-build-ostree-trigger-rhel-8.4-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.4-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.4-x86_64


image-build-ostree-trigger-rhel-8.5-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.5-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.5-aarch64


image-build-ostree-trigger-rhel-8.5-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.5-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.5-x86_64


image-build-ostree-trigger-rhel-8.6-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.6-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.6-aarch64


image-build-ostree-trigger-rhel-8.6-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.6-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.6-x86_64


image-build-ostree-trigger-rhel-8.7-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.7-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.7-aarch64


image-build-ostree-trigger-rhel-8.7-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.7-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.7-x86_64


image-build-ostree-trigger-rhel-8.8-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.8-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.8-aarch64


image-build-ostree-trigger-rhel-8.8-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.8-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.8-x86_64


image-build-ostree-trigger-rhel-8.9-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.9-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.9-aarch64


image-build-ostree-trigger-rhel-8.9-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-8.9-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-8.9-x86_64


image-build-ostree-trigger-rhel-9.0-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.0-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.0-aarch64


image-build-ostree-trigger-rhel-9.0-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.0-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.0-x86_64


image-build-ostree-trigger-rhel-9.1-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.1-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.1-aarch64


image-build-ostree-trigger-rhel-9.1-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.1-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.1-x86_64


image-build-ostree-trigger-rhel-9.2-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.2-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.2-aarch64


image-build-ostree-trigger-rhel-9.2-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.2-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.2-x86_64


image-build-ostree-trigger-rhel-9.3-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.3-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.3-aarch64


image-build-ostree-trigger-rhel-9.3-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.3-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.3-x86_64


image-build-ostree-trigger-rhel-9.4-aarch64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.4-aarch64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.4-aarch64


image-build-ostree-trigger-rhel-9.4-x86_64:
  stage: ostree-build
  trigger:
    include:
      - artifact: build-config.yml
        job: generate-ostree-build-config-rhel-9.4-x86_64
    strategy: depend
  needs:
    - generate-ostree-build-config-rhel-9.4-x86_64

generate-manifests-centos-10-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros centos-10 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-centos-10-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros centos-10 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-centos-8-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros centos-8 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-centos-9-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros centos-9 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-centos-9-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros centos-9 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-fedora-38-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros fedora-38 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-fedora-38-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros fedora-38 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-fedora-39-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros fedora-39 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-fedora-39-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros fedora-39 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-10.0-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-10.0 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-10.0-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-10.0 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.10-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-8.10 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.10-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-8.10 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.4-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-8.4 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.4-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-8.4 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.5-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-8.5 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.5-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-8.5 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.6-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-8.6 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.6-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-8.6 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.7-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-8.7 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.7-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-8.7 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.8-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-8.8 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.8-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-8.8 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.9-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-8.9 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-8.9-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-8.9 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.0-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-9.0 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.0-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-9.0 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.1-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-9.1 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.1-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-9.1 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.2-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-9.2 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.2-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-9.2 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.3-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-9.3 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.3-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-9.3 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.4-ppc64le:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches ppc64le --distros rhel-9.4 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done


generate-manifests-rhel-9.4-s390x:
  stage: gen
  extends: .terraform
  variables:
    RUNNER: aws/fedora-39-x86_64
    INTERNAL_NETWORK: "true"
  script:
    - sudo ./test/scripts/install-dependencies
    - go run ./cmd/gen-manifests --arches s390x --distros rhel-9.4 --workers 10 --metadata=false --output ./manifests
    - for manifest in ./manifests/*; do
        if osbuild --inspect $manifest > output; then
          echo "$manifest OK";
        else
          cat output;
        fi;
      done
